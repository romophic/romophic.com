---
import Link from '@/components/common/Link.astro'
import { badgeVariants } from '@/components/ui/badge'
import { ICONS } from '@/consts'
import { formatDate } from '@/lib/utils'
import type { Author } from '@/types'
import { Icon } from 'astro-icon/components'
import { Image } from 'astro:assets'
import type { CollectionEntry } from 'astro:content'

interface Props {
  post: CollectionEntry<'blog'>
  authors: Author[]
  postReadingTime: string
  combinedReadingTime: string | null
  subpostCount: number
}

const { post, authors, postReadingTime, combinedReadingTime, subpostCount } =
  Astro.props
---

<section class="col-start-2 flex flex-col gap-y-6 text-center">
  <div class="flex flex-col">
    <h1
      class="mb-2 scroll-mt-31 text-3xl leading-tight font-medium sm:text-4xl"
      id="post-title"
    >
      {post.data.title}
    </h1>

    <div
      class="text-muted-foreground divide-border mb-4 flex flex-col items-center justify-center divide-y text-xs sm:flex-row sm:flex-wrap sm:divide-x sm:divide-y-0 sm:text-sm"
    >
      {
        authors.length > 0 && (
          <div class="flex w-full items-center justify-center gap-x-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0">
            {authors.map((author) => (
              <div class="flex items-center gap-x-1.5">
                <Image
                  src={author.avatar}
                  alt={author.name}
                  width={20}
                  height={20}
                  class="rounded-full"
                />
                {author.isRegistered ? (
                  <Link
                    href={`/authors/${author.id}`}
                    underline
                    class="text-foreground"
                  >
                    <span>{author.name}</span>
                  </Link>
                ) : (
                  <span>{author.name}</span>
                )}
              </div>
            ))}
          </div>
        )
      }

      <div
        class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"
      >
        <span>{formatDate(post.data.date)}</span>
      </div>

      <div
        class="flex w-full items-center justify-center gap-2 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0"
      >
        <span>
          {postReadingTime}
          {
            combinedReadingTime && combinedReadingTime !== postReadingTime && (
              <span class="text-muted-foreground">
                {' '}
                ({combinedReadingTime} total)
              </span>
            )
          }
        </span>
      </div>

      {
        subpostCount > 0 && (
          <div class="flex w-full items-center justify-center gap-1 py-2 sm:w-fit sm:px-2 sm:py-0 first:sm:pl-0 last:sm:pr-0">
            <Icon name={ICONS.fileText} class="size-3" />
            {subpostCount} subpost{subpostCount === 1 ? '' : 's'}
          </div>
        )
      }
    </div>
    <div class="flex flex-wrap justify-center gap-2">
      {
        post.data.tags &&
          post.data.tags.length > 0 &&
          post.data.tags.map((tag) => (
            <a
              href={`/tags/${tag}`}
              class={badgeVariants({ variant: 'muted' })}
            >
              <Icon name={ICONS.hash} class="size-3" />
              {tag}
            </a>
          ))
      }
    </div>
  </div>
  <slot />
</section>
