---
---

<copy-code-manager></copy-code-manager>

<script>
  class CopyCodeManager extends HTMLElement {
    constructor() {
      super()
    }

    connectedCallback() {
      this.injectButtons()
    }

    injectButtons() {
      const codeBlocks = document.querySelectorAll('pre')

      codeBlocks.forEach((codeBlock) => {
        if (codeBlock.parentElement?.classList.contains('group')) return 

        const wrapper = document.createElement('div')
        wrapper.className = 'relative group'

        const copyButton = document.createElement('button')
        copyButton.className =
          'absolute right-2 top-2 hidden rounded-md border bg-muted p-1.5 text-muted-foreground opacity-0 transition-all hover:bg-background hover:text-foreground group-hover:block group-hover:opacity-100'
        copyButton.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
        `

        copyButton.addEventListener('click', async () => {
          const code = codeBlock.querySelector('code')?.innerText || ''
          await navigator.clipboard.writeText(code)

          copyButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><path d="M20 6 9 17l-5-5"/></svg>
          `

          setTimeout(() => {
            copyButton.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
            `
          }, 2000)
        })

        if (codeBlock.parentNode) {
            codeBlock.parentNode.insertBefore(wrapper, codeBlock);
            wrapper.appendChild(codeBlock);
            wrapper.appendChild(copyButton);
        }
      })
    }
  }

  customElements.define('copy-code-manager', CopyCodeManager)
</script>
