<div
  id="pwa-toast"
  role="alert"
  aria-labelledby="toast-message"
  class="bg-background text-foreground fixed right-4 bottom-4 z-50 translate-y-[150%] rounded-lg border p-4 shadow-lg transition-transform duration-300 data-[open=true]:translate-y-0 dark:border-zinc-800"
>
  <div class="flex items-start gap-3">
    <div class="flex-1">
      <h3 id="toast-message" class="text-sm font-medium">Update available</h3>
      <p class="text-muted-foreground mt-1 text-xs">
        New content is available, click on reload button to update.
      </p>
    </div>
    <div class="flex flex-col gap-2">
      <button
        id="pwa-refresh"
        type="button"
        class="bg-primary text-primary-foreground hover:bg-primary/90 focus-visible:ring-ring inline-flex items-center justify-center rounded-md px-3 py-1.5 text-xs font-medium shadow focus-visible:ring-1 focus-visible:outline-none"
      >
        Reload
      </button>
      <button
        id="pwa-close"
        type="button"
        class="text-muted-foreground hover:bg-muted hover:text-foreground focus-visible:ring-ring inline-flex items-center justify-center rounded-md border bg-transparent px-3 py-1.5 text-xs font-medium shadow-sm focus-visible:ring-1 focus-visible:outline-none"
      >
        Close
      </button>
    </div>
  </div>
</div>

<script>
  // @ts-expect-error virtual:pwa-register is a virtual module
  import { registerSW } from 'virtual:pwa-register'

  const updateSW = registerSW({
    onNeedRefresh() {
      const toast = document.getElementById('pwa-toast')
      if (toast) {
        toast.dataset.open = 'true'
      }
    },
    onOfflineReady() {
      console.log('App ready to work offline')
    },
  })

  const refreshButton = document.getElementById('pwa-refresh')
  refreshButton?.addEventListener('click', () => {
    updateSW(true)
  })

  const closeButton = document.getElementById('pwa-close')
  closeButton?.addEventListener('click', () => {
    const toast = document.getElementById('pwa-toast')
    if (toast) {
      toast.dataset.open = 'false'
    }
  })
</script>
